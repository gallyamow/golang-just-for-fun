package ratelimiter

import "context"

// RateLimiter
//
// Цели:
// Защита ресурсов
// Ограничение количества запросов к серверу, базе данных или API.
// Пример: API стороннего сервиса может разрешать максимум 1000 запросов в час. Rate limiter предотвращает превышение лимита.
//
// Предотвращение перегрузки.
// Контролирует поток запросов, чтобы система не «падала» под нагрузкой.
// Пример: ограничение одновременных соединений с базой данных.
//
// Сглаживание трафика.
// Устраняет резкие всплески запросов, которые могут вызвать сбои.
// Пример: пользователи массово кликают на кнопку — Token Bucket позволяет обработать «всплеск» без перегрузки.
//
// Контроль злоупотреблений и спама.
// Предотвращает DDoS-атаки или массовые автоматические действия.
// Пример: ограничение количества логинов или отправки сообщений с одного IP.
//
// Справедливое распределение ресурсов
// Все пользователи или клиенты получают равный доступ.
// Пример: SaaS-сервис позволяет каждому пользователю максимум 100 операций в минуту.
//
// Оптимизация стоимости и производительности.
// Контролирует расход ресурсов (CPU, память, трафик), особенно в облачных сервисах.
// Пример: ограничение частоты вызовов платного API, чтобы не тратить лишние деньги.
//
// Сравнение 2 реализаций:
//
// | Характеристика          | **Leaky Bucket** (протекающее ведро)                       | **Token Bucket** (токен-ведро)                       |
// | ----------------------- | ---------------------------------------------------------- | ---------------------------------------------------- |
// | **Тип ограничений**     | Ограничивает **скорость обработки**                        | Ограничивает **среднюю скорость**                    |
// | **Всплески**            | Нет — входные всплески не пропускаются                     | Да — можно накопить токены                        |
// | **Сглаживание**         | Очень ровный поток                                         | Поток неровный                                     |
// | **Использование**       | QoS, сетевые роутеры, RPC воркеры                          | API лимитеры, защита от всплесков                    |
// | **Семантика**           | Очередь + фиксированный drain rate                         | Ведро с токенами, расход по запросам                 |
// | **Отбрасывание**        | Отбрасывает при переполнении очереди                       | Отбрасывает, когда нет токенов                       |
// | **Ограничивает**        | То, что *вытекает*                                         | То, что можно *взять*                                |
// | **Сложность настройки** | Простая (capacity + leak rate)                             | Средняя (capacity + refill rate)                     |
// | **Типичное применение** | Сетевой трафик, нагрузка на дисковые операции, сглаживание | API rate limit, пользовательские ограничения, bursts |
type RateLimiter interface {
	// Allow позволяет проверить возможность без блокировки.
	Allow() bool

	// Wait блокирует выполнение до тех пор, пока не будет разрешено.
	Wait(ctx context.Context)
}
